\subsection{Branching scheme}

\begin{frame}
  \frametitle{Branching scheme }
  \begin{itemize}
    \vfill
  \item Step 1: ER checker and ER adjustments on current node 
    \vfill    
    \pause
  \item Step 2: Choose $st_i$ or $ft_i$ s.t. $[est_i,lst_i]$ or
    $[eet_i,let_i]$ min
    \vfill
    \pause
  \item Step 3: Create 2 nodes by separating the corresponding
    interval in 2 parts  {\small \it \color{gray!50!black!50} [Carlier
      \& Latapie, 1991]} 
  \end{itemize}
  \begin{overlayarea}{\textwidth}{4cm}
    \only<4>{
      \vfill
      {\it Ex with $st_i$:}
      \begin{center}
        \input{/home/mnattaf/Documents/input_latex/branching.tex}
      \end{center}
    }
    \only<5->{
      \begin{itemize}
      \item Repeat Steps 1--3 until each interval $\inter[est_i][lst_i]$ and $\inter[eet_i][let_i]$ has a size smaller than a given $\epsilon$ (DFS)\\
        \vspace{0.4cm}
        \pause
      \item MILP of the restricted problem
        \pause
        \begin{itemize}
        \item If MILP solved the problem: STOP
          \pause
        \item else : backtrack
        \end{itemize}
      \end{itemize}
    }
  \end{overlayarea}
  \vfill
\end{frame}

\subsection{Filtering algorithms}

\begin{frame}
  \frametitle{Energetic reasoning checker}
  {\small adaptation of the energetic reasoning for CuSP
    {\color{gray!50!black!50} \it [Baptiste et al., 2001]}}

  \vspace{0.4cm}
  \pause
  The slack function of interval $\inter$ is:
  \begin{gather}
    SL(t_1,t_2)={\color<3>{red!80!black!80}\text{ available space in
      }\inter}-{\color<3>{blue!80!black!80}\text{ total mandatory }} \nonumber\\ 
    {\color<3>{blue!80!black!80}\text{consumption in } \inter}\nonumber
  \end{gather}
  \begin{theorem}
    If there exists an interval on which the slack function is negative then there is no solution
  \end{theorem}
  \vfill
  \onslide<3>{
    \begin{center}
      \begin{tikzpicture}
        [transform shape,xscale=0.7,yscale=0.5]
        [inner sep=0pt]
        \node (O) at (0,0) {};
        \node[right of=O, node distance=6cm] (T) {};
        \node[right of=O, node distance=2cm] (t1) {};
        \node[right of=O, node distance=4cm] (t2) {};
        
        \draw[dashed] (0,4) node[left] {\Large$B$} -- (6,4);

        \draw[->] (O) -- (T);

        \draw[thick,red] (t1) -- (2,4.5);
        \draw[thick,red] (t2) -- (4,4.5);

        \draw[fill=blue!50!black!50] (t1) node[above=2cm,left=0.6cm] {\color{blue!80!black!80} \Large mandatory consumption} rectangle (4.5,4);
        \draw[pattern=north west lines, pattern color=red] (t1) rectangle (4,4) node[below=2cm,right=0.8cm] {\color{red} \Large available resource};
      \end{tikzpicture}
    \end{center}}
\end{frame}

\begin{frame}
  \frametitle{Energetic reasoning checker}
  \vfill
  We define the mandatory consumption of $i$ in interval $\inter$ as 
  \[\bb=\min \int_{t_1}^{t_2} b_i(t) dt\]
  \vfill
  In order to compute this quantity we also define the minimum energy
  consumption of $i$ in interval $\inter$ as:
  \[\wb=\min \int_{t_1}^{t_2} f_i(b_i(t)) dt\]
\end{frame}


\begin{frame}{Mandatory consumption possible configurations}
  \input{figures/ER_tab.tex}
  \onslide<6>{
    \[\wb = \min ( LS, RS, \max (BS_1,BS_2))\]
  }
\end{frame}

\begin{frame}
  \frametitle{Minimal resource consumption}
  \begin{center}
    \input{figures/resource_consumption.tex}
  \end{center}
  \vfill
  \pause
  \textbf{Question : }
  How can we bring an energy $\wb$ to $i$ in interval $J$ by consuming
  as few resource as possible? 
  \vfill
  \pause
  \begin{align*}
    \text{ min }& \int_{J} b_i(t)dt  \\
    \text{ s.t. } & \int_{J}f_i(b_i(t))dt \ge  \underline{w}(i,t_1,t_2) \\
                &  \bmax \ge b_i(t) \ge \bmin
  \end{align*}
  \vfill
\end{frame}

\begin{frame}
  \frametitle{Analytic expression of $\bb$}
  \vfill
  \begin{itemize}
  \item  \textbf{Question : }
    How can we bring an energy $\wb$ to $i$ in interval $J$ by consuming as few resource as possible?
    \vfill
    \begin{align*}
      \text{ min }& \int_{J} b_i(t)dt  \\
      \text{ s.t. } & \int_{J}f_i(b_i(t))dt \ge  \underline{w}(i,t_1,t_2) \\
                  &  \bmax \ge b_i(t) \ge \bmin
    \end{align*}
    \vfill
    \pause
  \item Theorem "piecewise constant $b_i(t)$" $\Rightarrow$ there is a constant $b_{i} > 0 $
    s.t. 
    \pause
    \begin{align*}
      \text{min }  & \int_{J} b_i\,dt  \\
      \text{s.t } & \int_{J}f_i(b_i)\,dt \ge
                    \underline{w}(i,t_1,t_2)\\
                   & \bmax \ge b_i \ge \bmin
    \end{align*}
  \end{itemize}
  \vfill
\end{frame}

\begin{frame}
  \frametitle{Analytic expression of $\bb$}
  \vfill
  $\bullet$ if $f_i$ is linear, i.e. of the form $f_i(b)= a_i*b+c_i$ :
  \pause
  \begin{align*}
    \text{min }  & \int_{J} b_i\,dt  \\
    \text{s.t } & \int_{J}(a_i*b_i+c_i)\,dt \ge
                  \underline{w}(i,t_1,t_2)\\
                 & \bmax \ge b_i \ge \bmin
  \end{align*}
  \pause
  { \color{blue!80!black!80}
    $\boldmath{\Rightarrow  \underline{b}(i,t_1,t_2)= \max ( |J|\bmin, \frac{1}{a_i}( \underline{w}(i,t_1,t_2)-|J|c_i))}$}.
  
\end{frame}

\begin{frame}
  \frametitle{Analytic expression of $\bb$}
  \vfill
  $\bullet$  if $f_i$ is concave and piecewise linear, i.e. of the form
  $f_i(b)=a_{ip}*b+c_{ip}, \forall p \in {\cal P}$:
  \pause

  \begin{align*}
    \text{min }  & \int_{J} b_i\,dt  \\
    \text{s.t } & \int_{J}(a_{ip}*b_i+c_{ip})\,dt \ge
                  \underline{w}(i,t_1,t_2) \qquad \forall p \in
                  {\cal P}\\
                 & \bmax \ge b_i \ge \bmin
  \end{align*}
  \pause
  { \color{blue!80!black!80}
    $\boldmath{\Rightarrow  \underline{b}(i,t_1,t_2)= \max ( |J|\bmin, \max_{p
        \in {\cal P}} \frac{1}{a_{ip}}( \underline{w}(i,t_1,t_2)-|J|c_{ip}))}$}
  \vfill
  \begin{prop}
    The slack function of $[t_1,t_2]$ can be computed in linear time
  \end{prop}
\end{frame}


\begin{frame}
  \frametitle{Relevant intervals}
  {\bf Question: } For which intervals $\inter$ we have to compute $SL(t_1,t_2)$?\\
  \vfill
  \pause
  $\rightarrow$ Analysis of the variation of the slack function (
  {\small CuSP : \it \color{gray!50!black!50} [Derrien \& Petit, 2015]})\\
  \vfill
  \pause
  \begin{block}{Slack function}
    \centering $SL(t_1,t_2)=B(t_2-t_1) - \sum_{i \in A} \bb$
  \end{block}
  \pause
  \vspace{0.8cm}
  $\rightarrow$ Variation of $SL(t_1,t_2)$ depends on variation of 
  $\sum_{i \in A} \bb$
  \vfill 
  \pause
  $\rightarrow$ Conditions on $t_1$ and $t_2$ over which they have to be
  considered 
  \vfill 
\end{frame}

% \begin{frame}{Example}

%   {\small
%   Case: $W_i \ge f_i(\bmax)( let_i-est_i)$ and $est_i < t_1 \le \frac{est_if_i(\bmax)-let_i f_i(\bmin)+W_i}{f_i(\bmax)-f_i(\bmin)}$}
%   \begin{center}
%     \begin{tikzpicture}
%       [yscale=0.2,xscale=0.4]
%       \node (O) at (0,0) {};
%       \draw[->] (-1,0) -- (18,0) node[below] {$t_2$};
%       \draw[->] (-1,0) -- (-1,15) node[left] {$\bb$};

%       \draw (0,1) -- (3,1) -- (6,6) -- (10,8) -- (13,13) -- (17,13);

%       \draw[dashed] (3,0) node[below] {$ lst_i$} -- (3,1);      
%       \draw[dashed] (6,0) node[below] {$\Delta(t_1)$} -- (6,6);  
%       \draw[dashed] (10,0)  -- (10,8);  
%       \draw[dashed] (13,0) node[below] {$ let_i$} -- (13,13);
%     \end{tikzpicture}
%   \end{center}
%   {\small with $\Delta(t_1)=\frac{W_i-f_i(\bmin)let_i
%   +t_1f_i(\bmax)}{f_i(\bmax)-f_i(\bmin)}$}

%   \vspace{0.2cm}

%   $\rightarrow$ We have to consider $[t_1,\Delta(t_1)]$ and $[t_1,d_i]$


%   \vspace{0.2cm}
%   $\rightarrow$ Polynomial number of interval (checker and filter)
%   \vfill 
% \end{frame}

\subsubsection{Energetic reasoning filter}

\begin{frame}
  \frametitle{Time window adjustments}
  \vspace{0.4cm}
  \begin{center}
    \input{figures/adjustments.tex}
  \end{center}
  \vfill
  \begin{block}{Adjustments}
    if {\color<2-3>{red!80!black!80} available space for $i$}$<${\color<3-4>{blue!80!black!80} consumption of $i$ starting at $est_i$}  then
    \[\textcolor<5>{red!80!black!80}{est_i \text{ can be adjusted}}\]
  \end{block}
  \vfill
\end{frame}

\subsubsection{Other filtering algorithms}

\begin{frame}{Other filtering algorithms}
  \vfill
  \begin{itemize}
  \item {\bf \color{blue!80!black!80} Simple reasoning: } adaptation of
    {\bf time-table} reasoning and {\bf disjunctive} reasoning
    \vfill
    \pause
    {\color{gray!80!black!80}{\it Idea: } Consider rectangular task with two modes

      $\rightarrow (\bmax, W_i/f_i(\bmax))$ maximal consumption/minimal time

      $\rightarrow (\bmin, W_i/f_i(\bmin))$ minimal consumption/maximal
      time}
  \end{itemize}
  \vfill
  \begin{center}
    \begin{tikzpicture}[xscale=0.5,yscale=0.6]
      \begin{scope}
        \node (O) at (0,0) {};
        \draw[->] (0,0) -- (5.5,0);
        \draw[->] (0,0) -- (0,4);
        
        \draw[fill=blue!80!black!80] (1,0) rectangle (3,3)
        node[midway,color=black] {$i$};
        
        \draw[<->] (1,-0.5) -- (3,-0.5) node[midway,below] {\footnotesize
          $W_i/f_i(\bmax)$};
        \draw[<->] (-0.5,0) -- (-0.5,3) node[midway,left] {\footnotesize $\bmax$};
      \end{scope}
      
      \begin{scope}[xshift=10cm]
        \node (O) at (0,0) {};
        \draw[->] (0,0) -- (5.5,0);
        \draw[->] (0,0) -- (0,4);
        
        \draw[fill=blue!80!black!80] (1,0) rectangle (5,1.5)
        node[midway,color=black] {$i$};
        
        \draw[<->] (1,-0.5) -- (5,-0.5) node[midway,below] {\footnotesize
          $W_i/f_i(\bmin)$};
        \draw[<->] (-0.5,0) -- (-0.5,1.5) node[midway,left] {\footnotesize $\bmin$};
      \end{scope}
      
    \end{tikzpicture}
  \end{center}
  
\end{frame}


\begin{frame}{Other filtering algorithms}
  \vfill
  \begin{itemize}
  \item {\bf \color{blue!80!black!80} Combined/Extended reasoning: }
    adaptation of the {\bf time-table disjunctive} reasoning (TTDR) and
    new {\bf time-table flow-based} satisfiability test (TTFB)
    \vfill
    \pause
    {\color{gray!80!black!80}{\it Idea: } TTDR $\rightarrow$ same as TT and DR
      
      TTBF $\rightarrow$ Flow-based LP with minimal consumption $\bmin$ in
      ${[}eet_i,lst_i {]}$ and $0$ outside}
  \end{itemize}
  \vfill
  
  \begin{center}
    \begin{tikzpicture}[xscale=0.7,yscale=0.6]
      
      \node (O) at (0,0) {};

      
      \draw[color=white] (0,0) rectangle (2,4)
      node[midway,color=black] {\rotatebox{90}{\footnotesize $b_i(t) \ge 0$}};
      \draw[color=white] (4,0) rectangle (5.5,4)
      node[midway,color=black] {\rotatebox{90}{\footnotesize $b_i(t) \ge 0$}};
      \draw[color=white] (2,0) rectangle (4,4)
      node[midway,color=black] {\rotatebox{90}{\footnotesize \color{blue!80!black!80}
        $b_i(t) \ge \bmin$}};
      \draw[->] (0,0) -- (5.5,0);

      \draw[dashed] (2,0) node[below] {\footnotesize $lst_i$} -- (2,4);
      \draw[dashed] (4,0) node[below] {\footnotesize $est_i$} -- (4,4);

    \end{tikzpicture}
  \end{center}
\end{frame}


  \subsection{Mixed Integer Linear Program}

  \begin{frame}
    \frametitle{On/Off formulation}
    {\small \it Adaptation of a model for the RCPSP {\color{gray!50!black!50} \it [KonÃ© et al., 2011]}}
    \vfill
    \begin{block}{Variables}
      \begin{itemize}
      \item  $t_e$ represents the event (start or end time)
        \pause
        \vspace{0.3cm}
      \item $z_{ie}=\left\{
          \begin{array}{ll}
            1 & \text{if $i$ is in process during $[t_{e},t_{e+1}]$}\\
            0 & \text{sinon}
          \end{array}
        \right.
        $
        \pause
        \vspace{0.3cm}
      \item $B_{ie}$: resource quantity consumed by $i$ in $\inter[t_e][t_{e+1}]$
        \vspace{0.3cm}
      \item $W_{ie}$: energy brought to $i$ in $\inter[t_e][t_{e+1}]$   
      \end{itemize}
    \end{block}
  \end{frame}


  \begin{frame}{Energy/Resource model}
    \vfill
    \begin{block}{On/Off model}
      {\footnotesize
        \begin{eqnarray*}
          \sum_{i\in A} B_{ie} \le B(t_{e+1}-t_e) & &\forall e \in {\cal E}\setminus \{2n\}\\
          B_{ie} \ge \bmin(t_{e+1}-t_e) - M{\color{blue!80!black!80}(1-z_{ie})} & & \forall e \in {\cal E}\setminus \{2n\}\ ;\forall i \in A\\
          B_{ie} \le \bmax(t_{e+1}-t_e) & &\forall e \in {\cal E}\setminus \{2n\}\ ;\forall i \in A\\
          {\color{red!80!black!80}z_{ie}}M\ge B_{ie} & & \forall e\in {\cal E}\setminus \{2n\}\
                                                         ;\forall i \in A\\
                                                  & & \\ \pause
          W_{ie} \le a_iB_{ie}+c_i(t_{e+1}-t_{e}) & & \forall e \in {\cal E}\setminus \{2n\};\ \forall i \in A\\
          W_{ie} \le W_i{\color{red!80!black!80}z_{ie}} & & \forall e \in {\cal E}\setminus \{2n\}\ ;\forall i \in A\\
          \sum_{e \in {\cal E}\setminus \{2n\}} W_{ie} = W_i & & \forall i \in A    
        \end{eqnarray*}
      }
    \end{block}
    \vfill
  \end{frame}

  \subsection{Computational results}

  \begin{frame}
    \frametitle{Branching scheme {\small \it \color{gray!50!black!50} [Carlier \& Latapie, 1991]}}
    \begin{itemize}
      \vfill
    \item Step 1: ER checker and ER adjustments on current node 
      \vfill    
    \item Step 2: Choose $st_i$ or $ft_i$ s.t. $[est_i,lst_i]$ or
      $[eet_i,let_i]$ min
      \vfill
    \item Step 3: Create 2 nodes by separating the corresponding interval in 2 parts
      \vfill
    \item{\color{red!80!black!80} Repeat Steps 1--4 until each interval $\inter[est_i][lst_i]$ and $\inter[eet_i][let_i]$ has a size smaller than a given $\epsilon$ (DFS)}
      \vfill
    \item MILP of the restricted problem
      \begin{itemize}
      \item If MILP solved the problem: STOP
      \item else : backtrack
      \end{itemize}
    \end{itemize}
    \vfill
  \end{frame}


  \begin{frame}
    \frametitle{Computational results}
    \vfill
    \begin{block}{Instance generation}
      \begin{itemize}
      \item 10 instances 10, 20 instances of 20, 25, 30 tasks. 
      \item half :random  $a_i$ and $c_i,\ \forall i \in A$, in ${[}1,10{]}$
        and $W_i$ in ${[}0,f_i(W_i){]}$

        o. half: $f_i(b_i(t))= b_i(t)$
      \item $\epsilon = \{5, 10, 15\}$ 
      \end{itemize}
    \end{block}
    \vfill
    \pause
    \begin{block}{Configuration}
      \begin{itemize}
      \item Intel Core i7-4770 processor with 4 cores and 8Go of RAM
      \item OS: 64-bit Ubuntu 12.04
      \item MILP resolution: CPLEX 12.6  
      \item BB : C++ and CPLEX at each leaf
      \item time limit: 7200 seconds
      \end{itemize}
    \end{block}
    \vfill
  \end{frame}


  \begin{frame}
    \frametitle{Computational results}
    \begin{figure}[!htb]
      \centering
      \begin{tikzpicture}
        [yscale=0.015,xscale=3.5]
        \node (O) at (1,0) {};
        
        \draw[->] (O.center) -- (1,250);
        \node at (0.7,125) {\rotatebox{90}{time (s)}};
        \draw[->] (O.center) -- (3.2,0);
        \node at (2,-30) {\#tasks};
        
        \foreach \i in {100,200}{
          \pgfmathsetmacro\result{\i * 10}
          \draw[dashed] (1,\i) node[left] {\scriptsize \pgfmathprintnumber{\result}} -- (3.2,\i);
        } 
        \foreach \i in {1,...,3}{
          \pgfmathsetmacro\result{\i * 10}
          \draw (\i,0) node[below] {\scriptsize \pgfmathprintnumber{\result}};
        }
        \draw (2.5,0) node[below] {\scriptsize $25$};

        \draw[color=blue!80!black!80,very thick] (1,0.015) node {$\bullet$}-- (2,0.7)node {$\bullet$}
        -- (2.5,5.415) node {$\bullet$}-- (3,9.485)node {$\bullet$};
        \draw[color=red!80!black!80,very thick] (1,0.026) node {$\bullet$}-- (2,2)node {$\bullet$}
        -- (2.5,21.95) node {$\bullet$}-- (3.0,210.86)node {$\bullet$};

        \draw[color=blue!80!black!80,very thick] (3.5,115) node[right]
        {$MILP$} -- (3.3,115);
        \draw[color=red!80!black!80,very thick] (3.5,135) node[right]
        {$\epsilon=2.5$} -- (3.3,135);
      \end{tikzpicture}
      \caption{\small Results of experiments for MILP model and hybrid branch-and-bound 
        with $\epsilon=2.5$ (CPU time in sec.)}
    \end{figure}
    {\small All instances solved except $30$-task instances $\rightarrow$ MILP only solved $75\%$}
  \end{frame}


